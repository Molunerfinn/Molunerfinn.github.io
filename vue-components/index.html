<!doctype html><html lang=en><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1,maximum-scale=1" name=viewport><meta content=Vue组件的三种调用方式 name=description><meta content=前端,Vue name=keywords><meta content=Molunerfinn name=author><meta content=Molunerfinn name=copyright><meta content=https://pic.molunerfinn.com/blog/avatar.jpeg property=og:image><meta content=https://pic.molunerfinn.com/blog/avatar.jpeg itemprop=image><title>Vue组件的三种调用方式 | MARKSZのBlog</title><link rel="shortcut icon" href=/favicon.ico><link href=/css/index.css rel=stylesheet><link href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1" rel=stylesheet><meta content="telephone=no" name=format-detection><meta content=on http-equiv=x-dns-prefetch-control><link href=https://cdn.jsdelivr.net rel=dns-prefetch><link href=https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css rel=stylesheet><script defer src=https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js></script><link href=https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js></script><script src=https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js></script><link href=/manifest.json rel=manifest><link href=/manifest.json rel=manifest><link href=https://hm.baidu.com rel=dns-prefetch><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?19a7ebdbb87f2403773c7ab0cae16d21";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><link href=https://www.google-analytics.com rel=dns-prefetch><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-105869658-1', 'auto');
ga('send', 'pageview');</script><meta content=kqRRHxwgvTJaCGlm5oGKbd7XGNwMLir6E0Q-VcQ3fJc name=google-site-verification><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"BGLU1ICJFH","apiKey":"85948beeaf121424b806828adc21c8b5","indexName":"mofinn","hits":{"per_page":10},"languages":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}.","hits_stats":"${hits} results found in ${time} ms"}},
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
}</script><meta content="Hexo 8.1.1" name=generator><link href=/atom.xml rel=alternate title=MARKSZのBlog type=application/atom+xml><body><canvas class=fireworks></canvas><i class="fa fa-arrow-right" aria-hidden=true id=toggle-sidebar></i><div data-display=true id=sidebar><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class=sidebar-toc><div class=sidebar-toc__title>Catalog</div><div class=sidebar-toc__progress><span class=progress-notice>You've read</span><span class=progress-num>0</span><span class=progress-percentage>%</span><div class=sidebar-toc__progress-bar></div></div><div class=sidebar-toc__content><ol class=toc><li class="toc-item toc-level-3"><a class=toc-link href=#Dialog><span class=toc-number>1.</span> <span class=toc-text>Dialog</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#Notice><span class=toc-number>2.</span> <span class=toc-text>Notice</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#Loading><span class=toc-number>3.</span> <span class=toc-text>Loading</span></a><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%80%BB%E7%BB%93><span class=toc-number>4.</span> <span class=toc-text>总结</span></a></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src=https://pic.molunerfinn.com/blog/avatar.jpeg></div><div class="author-info__name text-center">Molunerfinn</div><div class="author-info__description text-center">For MElody</div><div class=follow-button><a href=https://github.com/Molunerfinn>Follow Me</a></div><hr><div class=author-info-articles><a class="author-info-articles__archives article-meta" href=/archives><span class=pull-left>Articles</span><span class=pull-right>78</span></a><a class="author-info-articles__tags article-meta" href=/tags><span class=pull-left>Tags</span><span class=pull-right>24</span></a><a class="author-info-articles__categories article-meta" href=/categories><span class=pull-left>Categories</span><span class=pull-right>24</span></a></div><hr><div class=author-info-links><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href=https://molunerfinn.com>Molunerfinn</a><a class="author-info-links__name text-center" href=https://elody-07.github.io>Elody</a><a class="author-info-links__name text-center" href=https://elmagnifico.tech/>Elmagnifico</a></div></div></div><div id=content-outer><div style="background-image: url(https://pics.molunerfinn.com/blog/blog-bg.jpg)" id=top-container><div id=page-header><span class=pull-left> <a href=/ id=site-name>MARKSZのBlog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden=true></i><span class="pull-right menus"> <a class=site-page href=/about>About</a><a class=site-page href=/archives>Archives</a><a class=site-page href=/tags>Tags</a><a class=site-page href=/categories>Categories</a></span><span class=pull-right><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id=post-info><div id=post-title>Vue组件的三种调用方式</div><div id=post-meta><time class=post-meta__date><i class="fa fa-calendar" aria-hidden=true></i> 2017-06-15</time><span class=post-meta__separator>|</span><i class="fa fa-inbox post-meta__icon" aria-hidden=true></i><a class=post-meta__categories href=/categories/Web/>Web</a><i class="fa fa-angle-right" aria-hidden=true></i><i class="fa fa-inbox post-meta__icon" aria-hidden=true></i><a class=post-meta__categories href=/categories/Web/%E5%BC%80%E5%8F%91/>开发</a><div class=post-meta-wordcount><span>Word count: </span><span class=word-count>3.1k</span><span class=post-meta__separator>|</span><span>Reading time: 12 min</span></div></div></div></div><div class=layout id=content-inner><article id=post><div class=article-container id=post-content><p>最近在写<a href=https://fj.teamsz.xyz/>fj-service-system</a>的时候，遇到了一些问题。那就是我有些组件，比如<code>Dialog</code>、<code>Message</code>这样的组件，是引入三方组件库，比如<code>element-ui</code>这样的，还是自己实现一个？虽然它们有按需引入的功能，但是整体风格和我的整个系统不搭。于是就可以考虑自己手动实现这些简单的组件了。</p><span id=more></span><p>通常我们看Vue的一些文章的时候，我们能看到的通常是讲Vue单文件组件化开发页面的。单一组件开发的文章相对就较少了。我在做<a href=https://fj.teamsz.xyz/>fj-service-system</a>项目的时候，发现其实单一组件开发也是很有意思的。可以写写记录下来。因为写的不是什么ui框架，所以也只是一个记录，没有github仓库，权且看代码吧。<p>主要讲三种方式调用组件：<ul><li><code>v-model</code>或者<code>.sync</code>显式控制组件显示隐藏<li>通过js代码调用<li>通过Vue指令调用</ul><p>在写组件的时候很多写法、灵感来自于<a href=https://github.com/ElemeFE/element>element-ui</a>，感谢。<h3 id=Dialog><a class=headerlink href=#Dialog title=Dialog></a>Dialog</h3><p>我习惯把这个东西叫做对话框，实际上还有叫做modal(弹窗)组件的<a href=https://www.zhihu.com/question/35820643>叫法</a>。其实就是在页面里，弹出一个小窗口，这个小窗口里的内容可以定制。通常可以用来做登录功能的对话框。<p><img alt=dialog src=https://blog-1251750343.cos.ap-beijing.myqcloud.com/8700af19ly1fgoih3m6apg20kw0do4pv.gif><p>这种组件就很适合通过<code>v-model</code>或者<code>.sync</code>的方式来显式的控制出现和消失。它可以直接写在页面里，然后通过data去控制——这也是最符合Vue的设计思路的组件。<p>为此我们可以写一个组件就叫做<code>Dialog.vue</code><figure class="highlight html"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br></pre><td class=code><pre><span class=line><span class=tag>&lt;<span class=name>template</span>></span></span><br><span class=line>  <span class=tag>&lt;<span class=name>div</span> <span class=attr>class</span>=<span class=string>"dialog"</span>></span></span><br><span class=line>    <span class=tag>&lt;<span class=name>div</span> <span class=attr>class</span>=<span class=string>"dialog__wrapper"</span> <span class=attr>v-if</span>=<span class=string>"visble"</span> @<span class=attr>clcik</span>=<span class=string>"closeModal"</span>></span></span><br><span class=line>      <span class=tag>&lt;<span class=name>div</span> <span class=attr>class</span>=<span class=string>"dialog"</span>></span></span><br><span class=line>        <span class=tag>&lt;<span class=name>div</span> <span class=attr>class</span>=<span class=string>"dialog__header"</span>></span></span><br><span class=line>          <span class=tag>&lt;<span class=name>div</span> <span class=attr>class</span>=<span class=string>"dialog__title"</span>></span>{{ title }}<span class=tag>&lt;/<span class=name>div</span>></span></span><br><span class=line>        <span class=tag>&lt;/<span class=name>div</span>></span></span><br><span class=line>        <span class=tag>&lt;<span class=name>div</span> <span class=attr>class</span>=<span class=string>"dialog__body"</span>></span></span><br><span class=line>          <span class=tag>&lt;<span class=name>slot</span>></span><span class=tag>&lt;/<span class=name>slot</span>></span></span><br><span class=line>        <span class=tag>&lt;/<span class=name>div</span>></span></span><br><span class=line>        <span class=tag>&lt;<span class=name>div</span> <span class=attr>class</span>=<span class=string>"dialog__footer"</span>></span></span><br><span class=line>          <span class=tag>&lt;<span class=name>slot</span> <span class=attr>name</span>=<span class=string>"footer"</span>></span><span class=tag>&lt;/<span class=name>slot</span>></span></span><br><span class=line>        <span class=tag>&lt;/<span class=name>div</span>></span></span><br><span class=line>      <span class=tag>&lt;/<span class=name>div</span>></span></span><br><span class=line>    <span class=tag>&lt;/<span class=name>div</span>></span></span><br><span class=line>    <span class=tag>&lt;<span class=name>div</span> <span class=attr>class</span>=<span class=string>"modal"</span> <span class=attr>v-show</span>=<span class=string>"visible"</span>></span><span class=tag>&lt;/<span class=name>div</span>></span></span><br><span class=line>  <span class=tag>&lt;/<span class=name>div</span>></span></span><br><span class=line><span class=tag>&lt;/<span class=name>template</span>></span></span><br><span class=line></span><br><span class=line><span class=tag>&lt;<span class=name>script</span>></span><span class=language-javascript></span></span><br><span class=line><span class=language-javascript>  <span class=keyword>export</span> <span class=keyword>default</span> {</span></span><br><span class=line><span class=language-javascript>    <span class=attr>name</span>: <span class=string>'dialog'</span>,</span></span><br><span class=line><span class=language-javascript>    <span class=attr>props</span>: {</span></span><br><span class=line><span class=language-javascript>      <span class=attr>title</span>: <span class="title class_">String</span>,</span></span><br><span class=line><span class=language-javascript>      <span class=attr>visible</span>: {</span></span><br><span class=line><span class=language-javascript>        <span class=attr>type</span>: <span class="title class_">Boolean</span>,</span></span><br><span class=line><span class=language-javascript>        <span class=attr>default</span>: <span class=literal>false</span></span></span><br><span class=line><span class=language-javascript>      }</span></span><br><span class=line><span class=language-javascript>    },</span></span><br><span class=line><span class=language-javascript>    <span class=attr>methods</span>: {</span></span><br><span class=line><span class=language-javascript>      <span class="title function_">close</span>(<span class=params></span>) {</span></span><br><span class=line><span class=language-javascript>        <span class="variable language_">this</span>.$emit(<span class=string>'update:visible'</span>, <span class=literal>false</span>) <span class=comment>// 传递关闭事件</span></span></span><br><span class=line><span class=language-javascript>      },</span></span><br><span class=line><span class=language-javascript>      <span class="title function_">closeModal</span>(<span class=params>e</span>) {</span></span><br><span class=line><span class=language-javascript>        <span class=keyword>if</span> (<span class="variable language_">this</span>.<span class=property>visible</span>) {</span></span><br><span class=line><span class=language-javascript>          <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class=string>'.dialog'</span>).<span class="title function_">contains</span>(e.<span class=property>target</span>) ? <span class=string>''</span> : <span class="variable language_">this</span>.<span class="title function_">close</span>(); <span class=comment>// 判断点击的落点在不在dialog对话框内，如果在对话框外就调用this.close()方法关闭对话框</span></span></span><br><span class=line><span class=language-javascript>        }</span></span><br><span class=line><span class=language-javascript>      }</span></span><br><span class=line><span class=language-javascript>    }</span></span><br><span class=line><span class=language-javascript>  }</span></span><br><span class=line><span class=language-javascript></span><span class=tag>&lt;/<span class=name>script</span>></span></span><br></pre></table></figure><p>CSS什么的就不写了，跟组件本身关系比较小。不过值得注意的是，上面的<code>dialog__wrapper</code>这个class也是全屏的，透明的，主要用于获取点击事件并锁定点击的位置，通过DOM的<code>Node.contains()</code>方法来判断点击的位置是不是dialog本身，如果是点击到了dialog外面，比如半透明的<code>modal</code>层那么就派发关闭事件，把dialog给关闭掉。<p>当我们在外部要调用的时候，就可以如下调用：<figure class="highlight html"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br></pre><td class=code><pre><span class=line><span class=tag>&lt;<span class=name>template</span>></span></span><br><span class=line>  <span class=tag>&lt;<span class=name>div</span> <span class=attr>class</span>=<span class=string>"xxx"</span>></span></span><br><span class=line>    <span class=tag>&lt;<span class=name>dialog</span> <span class=attr>:visible.sync</span>=<span class=string>"visible"</span>></span><span class=tag>&lt;/<span class=name>dialog</span>></span> </span><br><span class=line>    <span class=tag>&lt;<span class=name>button</span> @<span class=attr>click</span>=<span class=string>"openDialog"</span>></span><span class=tag>&lt;/<span class=name>button</span>></span></span><br><span class=line>  <span class=tag>&lt;/<span class=name>div</span>></span></span><br><span class=line><span class=tag>&lt;/<span class=name>template</span>></span></span><br><span class=line></span><br><span class=line><span class=tag>&lt;<span class=name>script</span>></span><span class=language-javascript></span></span><br><span class=line><span class=language-javascript>  <span class=keyword>import</span> <span class="title class_">Dialog</span> <span class=keyword>from</span> <span class=string>'Dialog'</span></span></span><br><span class=line><span class=language-javascript>  <span class=keyword>export</span> <span class=keyword>default</span> {</span></span><br><span class=line><span class=language-javascript>    <span class=attr>components</span>: {</span></span><br><span class=line><span class=language-javascript>      <span class="title class_">Dialog</span></span></span><br><span class=line><span class=language-javascript>    },</span></span><br><span class=line><span class=language-javascript>    <span class="title function_">data</span>(<span class=params></span>) {</span></span><br><span class=line><span class=language-javascript>      <span class=keyword>return</span> {</span></span><br><span class=line><span class=language-javascript>        <span class=attr>visible</span>: <span class=literal>false</span></span></span><br><span class=line><span class=language-javascript>      }</span></span><br><span class=line><span class=language-javascript>    },</span></span><br><span class=line><span class=language-javascript>    <span class=attr>methods</span>: {</span></span><br><span class=line><span class=language-javascript>      <span class="title function_">openDialog</span>(<span class=params></span>) {</span></span><br><span class=line><span class=language-javascript>        <span class="variable language_">this</span>.<span class=property>visible</span> = <span class=literal>true</span> <span class=comment>// 通过data显式控制dialog</span></span></span><br><span class=line><span class=language-javascript>      }</span></span><br><span class=line><span class=language-javascript>    }</span></span><br><span class=line><span class=language-javascript>  }</span></span><br><span class=line><span class=language-javascript></span><span class=tag>&lt;/<span class=name>script</span>></span></span><br></pre></table></figure><p>为了Dialog开启和关闭好看点，你可试着加上<code>&lt;transition>&lt;/transition></code>组件配合上过渡效果，简单的一点过渡动效也将会很好看。<h3 id=Notice><a class=headerlink href=#Notice title=Notice></a>Notice</h3><p>这个组件类似于<code>element-ui</code>的<a href=http://element.eleme.io/#/zh-CN/component/message>message</a>（消息提示）。它吸引我的最大的地方在于，它不是通过显式的在页面里写好组件的html结构通过v-model去调用的，而是通过在js里通过形如<code>this.$message()</code>这样的方法调用的。这种方法虽然跟Vue的数据驱动的思想有所违背。不过不得不说在某些情况下真的特别方便。<p><img alt=notice src=https://blog-1251750343.cos.ap-beijing.myqcloud.com/8700af19ly1fgoiiwtkymg20ju07m46t.gif><p>对于Notice这种组件，一次只要提示几个文字，给用户简单的消息提示就行了。提示的信息可能是多变的，甚至可以出现叠加的提示。如果通过第一种方式去调用，事先就得写好html结构，这无疑是麻烦的做法，而且无法预知有多少消息提示框。而通过js的方法调用的话，只需要考虑不同情况调用的文字、类型不同就可以了。<p>而之前的做法都是写一个Vue文件，然后通过<code>components</code>属性引入页面，显式写入标签调用的。那么如何将组件通过js的方法去调用呢？<p>这里的关键是Vue的<code>extend</code><a href=https://vuejs.org/v2/api/#Vue-extend>方法</a>。<p>文档里并没有详细给出<code>extend</code>能这么用，只是作为需要手动<code>mount</code>的一个Vue的组件构造器说明了一下而已。<p>通过查看<code>element-ui</code>的源码，才算是理解了如何实现上述的功能。<p>首先依然是创建一个<code>Notice.vue</code>的文件<figure class="highlight html"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br></pre><td class=code><pre><span class=line><span class=tag>&lt;<span class=name>template</span>></span></span><br><span class=line>  <span class=tag>&lt;<span class=name>div</span> <span class=attr>class</span>=<span class=string>"notice"</span>></span></span><br><span class=line>    <span class=tag>&lt;<span class=name>div</span> <span class=attr>class</span>=<span class=string>"content"</span>></span></span><br><span class=line>      {{ content }}</span><br><span class=line>    <span class=tag>&lt;/<span class=name>div</span>></span></span><br><span class=line>  <span class=tag>&lt;/<span class=name>div</span>></span></span><br><span class=line><span class=tag>&lt;/<span class=name>template</span>></span></span><br><span class=line></span><br><span class=line><span class=tag>&lt;<span class=name>script</span>></span><span class=language-javascript></span></span><br><span class=line><span class=language-javascript>  <span class=keyword>export</span> <span class=keyword>default</span> {</span></span><br><span class=line><span class=language-javascript>    <span class=attr>name</span>: <span class=string>'notice'</span>,</span></span><br><span class=line><span class=language-javascript>    <span class="title function_">data</span> () {</span></span><br><span class=line><span class=language-javascript>      <span class=keyword>return</span> {</span></span><br><span class=line><span class=language-javascript>        <span class=attr>visible</span>: <span class=literal>false</span>,</span></span><br><span class=line><span class=language-javascript>        <span class=attr>content</span>: <span class=string>''</span>,</span></span><br><span class=line><span class=language-javascript>        <span class=attr>duration</span>: <span class=number>3000</span></span></span><br><span class=line><span class=language-javascript>      }</span></span><br><span class=line><span class=language-javascript>    },</span></span><br><span class=line><span class=language-javascript>    <span class=attr>methods</span>: {</span></span><br><span class=line><span class=language-javascript>      <span class="title function_">setTimer</span>(<span class=params></span>) {</span></span><br><span class=line><span class=language-javascript>        <span class=built_in>setTimeout</span>(<span class=function>() =></span> {</span></span><br><span class=line><span class=language-javascript>          <span class="variable language_">this</span>.<span class="title function_">close</span>() <span class=comment>// 3000ms之后调用关闭方法</span></span></span><br><span class=line><span class=language-javascript>        }, <span class="variable language_">this</span>.<span class=property>duration</span>)</span></span><br><span class=line><span class=language-javascript>      },</span></span><br><span class=line><span class=language-javascript>      <span class="title function_">close</span>(<span class=params></span>) {</span></span><br><span class=line><span class=language-javascript>        <span class="variable language_">this</span>.<span class=property>visible</span> = <span class=literal>false</span></span></span><br><span class=line><span class=language-javascript>        <span class=built_in>setTimeout</span>(<span class=function>() =></span> {</span></span><br><span class=line><span class=language-javascript>          <span class="variable language_">this</span>.$destroy(<span class=literal>true</span>)</span></span><br><span class=line><span class=language-javascript>          <span class="variable language_">this</span>.<span class=property>$el</span>.<span class=property>parentNode</span>.<span class="title function_">removeChild</span>(<span class="variable language_">this</span>.<span class=property>$el</span>) <span class=comment>// 从DOM里将这个组件移除</span></span></span><br><span class=line><span class=language-javascript>        }, <span class=number>500</span>)</span></span><br><span class=line><span class=language-javascript>      }</span></span><br><span class=line><span class=language-javascript>    },</span></span><br><span class=line><span class=language-javascript>    <span class="title function_">mounted</span>(<span class=params></span>) {</span></span><br><span class=line><span class=language-javascript>      <span class="variable language_">this</span>.<span class="title function_">setTimer</span>() <span class=comment>// 挂载的时候就开始计时，3000ms后消失</span></span></span><br><span class=line><span class=language-javascript>    }</span></span><br><span class=line><span class=language-javascript>  }</span></span><br><span class=line><span class=language-javascript></span><span class=tag>&lt;/<span class=name>script</span>></span></span><br></pre></table></figure><p>上面写的东西跟普通的一个单文件Vue组件没有什么太大的区别。不过区别就在于，没有props了，那么是如何通过外部来控制这个组件的显隐呢？<p>所以还需要一个js文件来接管这个组件，并调用<code>extend</code>方法。同目录下可以创建一个<code>index.js</code>的文件。<figure class="highlight js"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br></pre><td class=code><pre><span class=line><span class=keyword>import</span> <span class="title class_">Vue</span> <span class=keyword>from</span> <span class=string>'vue'</span></span><br><span class=line></span><br><span class=line><span class=keyword>const</span> <span class="title class_">NoticeConstructor</span> = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(<span class=built_in>require</span>(<span class=string>'./Notice.vue'</span>)) <span class=comment>// 直接将Vue组件作为Vue.extend的参数</span></span><br><span class=line></span><br><span class=line><span class=keyword>let</span> nId = <span class=number>1</span></span><br><span class=line></span><br><span class=line><span class=keyword>const</span> <span class="title function_">Notice</span> = (<span class=params>content</span>) => {</span><br><span class=line>  <span class=keyword>let</span> id = <span class=string>'notice-'</span> + nId++</span><br><span class=line></span><br><span class=line>  <span class=keyword>const</span> <span class="title class_">NoticeInstance</span> = <span class=keyword>new</span> <span class="title class_">NoticeConstructor</span>({</span><br><span class=line>    <span class=attr>data</span>: {</span><br><span class=line>      <span class=attr>content</span>: content</span><br><span class=line>    }</span><br><span class=line>  }) <span class=comment>// 实例化一个带有content内容的Notice</span></span><br><span class=line></span><br><span class=line>  <span class="title class_">NoticeInstance</span>.<span class=property>id</span> = id</span><br><span class=line>  <span class="title class_">NoticeInstance</span>.<span class=property>vm</span> = <span class="title class_">NoticeInstance</span>.$mount() <span class=comment>// 挂载但是并未插入dom，是一个完整的Vue实例</span></span><br><span class=line>  <span class="title class_">NoticeInstance</span>.<span class=property>vm</span>.<span class=property>visible</span> = <span class=literal>true</span></span><br><span class=line>  <span class="title class_">NoticeInstance</span>.<span class=property>dom</span> = <span class="title class_">NoticeInstance</span>.<span class=property>vm</span>.<span class=property>$el</span></span><br><span class=line>  <span class="variable language_">document</span>.<span class=property>body</span>.<span class="title function_">appendChild</span>(<span class="title class_">NoticeInstance</span>.<span class=property>dom</span>) <span class=comment>// 将dom插入body</span></span><br><span class=line>  <span class="title class_">NoticeInstance</span>.<span class=property>dom</span>.<span class=property>style</span>.<span class=property>zIndex</span> = nId + <span class=number>1001</span> <span class=comment>// 后插入的Notice组件z-index加一，保证能盖在之前的上面</span></span><br><span class=line>  <span class=keyword>return</span> <span class="title class_">NoticeInstance</span>.<span class=property>vm</span></span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>default</span> {</span><br><span class=line>  <span class=attr>install</span>: <span class=function><span class=params>Vue</span> =></span> {</span><br><span class=line>    <span class="title class_">Vue</span>.<span class=property><span class=keyword>prototype</span></span>.<span class=property>$notice</span> = <span class="title class_">Notice</span> <span class=comment>// 将Notice组件暴露出去，并挂载在Vue的prototype上</span></span><br><span class=line>  }</span><br><span class=line>}</span><br></pre></table></figure><p>这个文件里我们能看到通过<code>NoticeConstructor</code>我们能够通过js的方式去控制一个组件的各种属性。最后我们把它注册进Vue的prototype上，这样我们就可以在页面内部使用形如<code>this.$notice()</code>方法了，可以方便调用这个组件来写做出简单的通知提示效果了。<p>当然别忘了这个相当于一个Vue的插件，所以需要去主js里调用一下<code>Vue.use()</code>方法：<figure class="highlight js"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line><span class=comment>// main.js</span></span><br><span class=line></span><br><span class=line><span class=comment>// ...</span></span><br><span class=line><span class=keyword>import</span> <span class="title class_">Notice</span> <span class=keyword>from</span> <span class=string>'notice/index.js'</span></span><br><span class=line></span><br><span class=line><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Notice</span>)</span><br><span class=line></span><br><span class=line><span class=comment>// ...</span></span><br><span class=line></span><br></pre></table></figure><h3 id=Loading><a class=headerlink href=#Loading title=Loading></a>Loading</h3><p>在看<code>element-ui</code>的时候，我也发现了一个很有意思的组件，是<code>Loading</code>，用于给一些需要加载数据等待的组件套上一层加载中的样式的。这个loading的调用方式，最方便的就是通过<code>v-loading</code>这个指令，通过赋值的<code>true/false</code>来控制Loading层的显隐。这样的调用方法当然也是很方便的。而且可以选择整个页面Loading或者某个组件Loading。这样的开发体验自然是很好的。<p><img alt=loading src=https://blog-1251750343.cos.ap-beijing.myqcloud.com/8700af19ly1fgoija6xrkg20k6082js0.gif><p>其实跟Notice的思路差不多，不过因为涉及到<code>directive</code>，所以在逻辑上会相对复杂一点。<p>平时如果不涉及Vue的<code>directive</code>的开发，可能是不会接触到<code>modifiers</code>、<code>binding</code>等概念。参考<a href=https://vuejs.org/v2/guide/custom-directive.html>文档</a><p>简单说下，形如<code>:v-loading.fullscreen="true"</code>这句话，<code>v-loading</code>就是<code>directive</code>，<code>fullscreen</code>就是它的<code>modifier</code>，<code>true</code>就是<code>binding</code>的<code>value</code>值。所以，就是通过这样简单的一句话实现全屏的loading效果，并且当没有<code>fullscreen</code>修饰符的时候就是对拥有该指令的元素进行<code>loading</code>效果。组件通过<code>binding</code>的<code>value</code>值来控制<code>loading</code>的开启和关闭。（类似于<code>v-model</code>的效果）<p>其实loading也是一个实际的DOM节点，只不过要把它做成一个方便的指令还不是特别容易。<p>首先我们需要写一下<code>loading</code>的Vue组件。新建一个<code>Loading.vue</code>文件<figure class="highlight html"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br></pre><td class=code><pre><span class=line><span class=tag>&lt;<span class=name>template</span>></span></span><br><span class=line>  <span class=tag>&lt;<span class=name>transition</span></span></span><br><span class=line><span class=tag>    <span class=attr>name</span>=<span class=string>"loading"</span></span></span><br><span class=line><span class=tag>  	@<span class=attr>after-leave</span>=<span class=string>"handleAfterLeave"</span>></span></span><br><span class=line>    <span class=tag>&lt;<span class=name>div</span></span></span><br><span class=line><span class=tag>      <span class=attr>v-show</span>=<span class=string>"visible"</span></span></span><br><span class=line><span class=tag>      <span class=attr>class</span>=<span class=string>"loading-mask"</span></span></span><br><span class=line><span class=tag>      <span class=attr>:class</span>=<span class=string>{</span>'<span class=attr>fullscreen</span>'<span class=attr>:</span> <span class=attr>fullscreen</span>}></span></span><br><span class=line>      <span class=tag>&lt;<span class=name>div</span> <span class=attr>class</span>=<span class=string>"loading"</span>></span></span><br><span class=line>        ...</span><br><span class=line>      <span class=tag>&lt;/<span class=name>div</span>></span></span><br><span class=line>      <span class=tag>&lt;<span class=name>div</span> <span class=attr>class</span>=<span class=string>"loading-text"</span> <span class=attr>v-if</span>=<span class=string>"text"</span>></span></span><br><span class=line>        {{ text }}</span><br><span class=line>      <span class=tag>&lt;/<span class=name>div</span>></span></span><br><span class=line>    <span class=tag>&lt;/<span class=name>div</span>></span></span><br><span class=line>  <span class=tag>&lt;/<span class=name>transition</span>></span></span><br><span class=line><span class=tag>&lt;/<span class=name>template</span>></span></span><br><span class=line><span class=tag>&lt;<span class=name>script</span>></span><span class=language-javascript></span></span><br><span class=line><span class=language-javascript><span class=keyword>export</span> <span class=keyword>default</span> {</span></span><br><span class=line><span class=language-javascript>  <span class=attr>name</span>: <span class=string>'loading'</span>,</span></span><br><span class=line><span class=language-javascript>  <span class="title function_">data</span> () {</span></span><br><span class=line><span class=language-javascript>    <span class=keyword>return</span> {</span></span><br><span class=line><span class=language-javascript>      <span class=attr>visible</span>: <span class=literal>true</span>,</span></span><br><span class=line><span class=language-javascript>      <span class=attr>fullscreen</span>: <span class=literal>true</span>,</span></span><br><span class=line><span class=language-javascript>      <span class=attr>text</span>: <span class=literal>null</span></span></span><br><span class=line><span class=language-javascript>    }</span></span><br><span class=line><span class=language-javascript>  },</span></span><br><span class=line><span class=language-javascript>  <span class=attr>methods</span>: {</span></span><br><span class=line><span class=language-javascript>    <span class="title function_">handleAfterLeave</span>(<span class=params></span>) {</span></span><br><span class=line><span class=language-javascript>      <span class="variable language_">this</span>.$emit(<span class=string>'after-leave'</span>);</span></span><br><span class=line><span class=language-javascript>    }</span></span><br><span class=line><span class=language-javascript>  }</span></span><br><span class=line><span class=language-javascript>}</span></span><br><span class=line><span class=language-javascript></span><span class=tag>&lt;/<span class=name>script</span>></span></span><br><span class=line><span class=tag>&lt;<span class=name>style</span>></span><span class=language-css></span></span><br><span class=line><span class=language-css><span class=selector-class>.loading-mask</span>{</span></span><br><span class=line><span class=language-css>  <span class=attribute>position</span>: absolute; // 非全屏模式下，<span class=attribute>position</span>是absolute</span></span><br><span class=line><span class=language-css>  <span class=attribute>z-index</span>: <span class=number>10000</span>;</span></span><br><span class=line><span class=language-css>  <span class=attribute>background-color</span>: <span class=built_in>rgba</span>(<span class=number>255</span>,<span class=number>235</span>,<span class=number>215</span>, .<span class=number>8</span>);</span></span><br><span class=line><span class=language-css>  <span class=attribute>margin</span>: <span class=number>0</span>;</span></span><br><span class=line><span class=language-css>  <span class=attribute>top</span>: <span class=number>0</span>;</span></span><br><span class=line><span class=language-css>  <span class=attribute>right</span>: <span class=number>0</span>;</span></span><br><span class=line><span class=language-css>  <span class=attribute>bottom</span>: <span class=number>0</span>;</span></span><br><span class=line><span class=language-css>  <span class=attribute>left</span>: <span class=number>0</span>;</span></span><br><span class=line><span class=language-css>  <span class=attribute>transition</span>: opacity .<span class=number>3s</span>;</span></span><br><span class=line><span class=language-css>}</span></span><br><span class=line><span class=language-css><span class=selector-class>.loading-mask</span><span class=selector-class>.fullscreen</span>{</span></span><br><span class=line><span class=language-css>  <span class=attribute>position</span>: fixed; // 全屏模式下，<span class=attribute>position</span>是fixed</span></span><br><span class=line><span class=language-css>}</span></span><br><span class=line><span class=language-css>// ...</span></span><br><span class=line><span class=language-css></span><span class=tag>&lt;/<span class=name>style</span>></span></span><br></pre></table></figure><p>Loading关键是实现两个效果：<ol><li>全屏loading，此时可以通过插入body下，然后将Loading的position改为fixed，插入body实现。<li>对所在的元素进行loading，此时需要对当前这个元素的的position修改：如果不是<code>absolute</code>的话，就将其修改为<code>relatvie</code>，并插入当前元素下。此时Loading的position就会相对于当前元素进行绝对定位了。</ol><p>所以在当前目录下创建一个<code>index.js</code>的文件，用来声明我们的<code>directive</code>的逻辑。<figure class="highlight js"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br></pre><td class=code><pre><span class=line><span class=keyword>import</span> <span class="title class_">Vue</span> <span class=keyword>from</span> <span class=string>'vue'</span></span><br><span class=line><span class=keyword>const</span> <span class="title class_">LoadingConstructor</span> = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(<span class=built_in>require</span>(<span class=string>'./Loading.vue'</span>))</span><br><span class=line></span><br><span class=line><span class=keyword>export</span> <span class=keyword>default</span> {</span><br><span class=line>  <span class=attr>install</span>: <span class=function><span class=params>Vue</span> =></span> {</span><br><span class=line>    <span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class=string>'loading'</span>, { <span class=comment>// 指令的关键</span></span><br><span class=line>      <span class=attr>bind</span>: <span class=function>(<span class=params>el, binding</span>) =></span> {</span><br><span class=line>        <span class=keyword>const</span> loading = <span class=keyword>new</span> <span class="title class_">LoadingConstructor</span>({ <span class=comment>// 实例化一个loading</span></span><br><span class=line>          <span class=attr>el</span>: <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class=string>'div'</span>),</span><br><span class=line>          <span class=attr>data</span>: {</span><br><span class=line>            <span class=attr>text</span>: el.<span class="title function_">getAttribute</span>(<span class=string>'loading-text'</span>), <span class=comment>// 通过loading-text属性获取loading的文字</span></span><br><span class=line>            <span class=attr>fullscreen</span>: !!binding.<span class=property>modifiers</span>.<span class=property>fullscreen</span> </span><br><span class=line>          }</span><br><span class=line>        })</span><br><span class=line>        el.<span class=property>instance</span> = loading; <span class=comment>// el.instance是个Vue实例</span></span><br><span class=line>        el.<span class=property>loading</span> = loading.<span class=property>$el</span>; <span class=comment>// el.loading的DOM元素是loading.$el</span></span><br><span class=line>        el.<span class=property>loadingStyle</span> = {};</span><br><span class=line>        <span class="title function_">toggleLoading</span>(el, binding);</span><br><span class=line>      },</span><br><span class=line>      <span class=attr>update</span>: <span class=function>(<span class=params>el, binding</span>) =></span> {</span><br><span class=line>        el.<span class=property>instance</span>.<span class="title function_">setText</span>(el.<span class="title function_">getAttribute</span>(<span class=string>'loading-text'</span>))</span><br><span class=line>        <span class=keyword>if</span>(binding.<span class=property>oldValue</span> !== binding.<span class=property>value</span>) {</span><br><span class=line>          <span class="title function_">toggleLoading</span>(el, binding)</span><br><span class=line>        }   </span><br><span class=line>      },</span><br><span class=line>      <span class=attr>unbind</span>: <span class=function>(<span class=params>el, binding</span>) =></span> { <span class=comment>// 解绑</span></span><br><span class=line>        <span class=keyword>if</span>(el.<span class=property>domInserted</span>) {</span><br><span class=line>          <span class=keyword>if</span>(binding.<span class=property>modifiers</span>.<span class=property>fullscreen</span>) {</span><br><span class=line>              <span class="variable language_">document</span>.<span class=property>body</span>.<span class="title function_">removeChild</span>(el.<span class=property>loading</span>);</span><br><span class=line>          }<span class=keyword>else</span> {</span><br><span class=line>            el.<span class=property>loading</span> &&</span><br><span class=line>            el.<span class=property>loading</span>.<span class=property>parentNode</span> &&</span><br><span class=line>            el.<span class=property>loading</span>.<span class=property>parentNode</span>.<span class="title function_">removeChild</span>(el.<span class=property>loading</span>);</span><br><span class=line>          }</span><br><span class=line>        }</span><br><span class=line>      }</span><br><span class=line>    })</span><br><span class=line></span><br><span class=line>    <span class=keyword>const</span> <span class="title function_">toggleLoading</span> = (<span class=params>el, binding</span>) => { <span class=comment>// 用于控制Loading的出现与消失</span></span><br><span class=line>      <span class=keyword>if</span>(binding.<span class=property>value</span>) { </span><br><span class=line>        <span class="title class_">Vue</span>.<span class="title function_">nextTick</span>(<span class=function>() =></span> {</span><br><span class=line>          <span class=keyword>if</span> (binding.<span class=property>modifiers</span>.<span class=property>fullscreen</span>) { <span class=comment>// 如果是全屏</span></span><br><span class=line>            el.<span class=property>originalPosition</span> = <span class="variable language_">document</span>.<span class=property>body</span>.<span class=property>style</span>.<span class=property>position</span>;</span><br><span class=line>            el.<span class=property>originalOverflow</span> = <span class="variable language_">document</span>.<span class=property>body</span>.<span class=property>style</span>.<span class=property>overflow</span>;</span><br><span class=line>            <span class="title function_">insertDom</span>(<span class="variable language_">document</span>.<span class=property>body</span>, el, binding); <span class=comment>// 插入dom</span></span><br><span class=line>          } <span class=keyword>else</span> {</span><br><span class=line>            el.<span class=property>originalPosition</span> = el.<span class=property>style</span>.<span class=property>position</span>;</span><br><span class=line>            <span class="title function_">insertDom</span>(el, el, binding); <span class=comment>// 如果非全屏，插入元素自身</span></span><br><span class=line>          }</span><br><span class=line>        })</span><br><span class=line>      } <span class=keyword>else</span> {</span><br><span class=line>        <span class=keyword>if</span> (el.<span class=property>domVisible</span>) {</span><br><span class=line>          el.<span class=property>instance</span>.$on(<span class=string>'after-leave'</span>, <span class=function>() =></span> {</span><br><span class=line>            el.<span class=property>domVisible</span> = <span class=literal>false</span>;</span><br><span class=line>            <span class=keyword>if</span> (binding.<span class=property>modifiers</span>.<span class=property>fullscreen</span> && el.<span class=property>originalOverflow</span> !== <span class=string>'hidden'</span>) {</span><br><span class=line>              <span class="variable language_">document</span>.<span class=property>body</span>.<span class=property>style</span>.<span class=property>overflow</span> = el.<span class=property>originalOverflow</span>;</span><br><span class=line>            }</span><br><span class=line>            <span class=keyword>if</span> (binding.<span class=property>modifiers</span>.<span class=property>fullscreen</span>) {</span><br><span class=line>              <span class="variable language_">document</span>.<span class=property>body</span>.<span class=property>style</span>.<span class=property>position</span> = el.<span class=property>originalPosition</span>;</span><br><span class=line>            } <span class=keyword>else</span> {</span><br><span class=line>              el.<span class=property>style</span>.<span class=property>position</span> = el.<span class=property>originalPosition</span>;</span><br><span class=line>            }</span><br><span class=line>          });</span><br><span class=line>          el.<span class=property>instance</span>.<span class=property>visible</span> = <span class=literal>false</span>;</span><br><span class=line>        }</span><br><span class=line>      }</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>const</span> <span class="title function_">insertDom</span> = (<span class=params>parent, el, binding</span>) => { <span class=comment>// 插入dom的逻辑</span></span><br><span class=line>      <span class=keyword>if</span>(!el.<span class=property>domVisible</span>) {</span><br><span class=line>        <span class="title class_">Object</span>.<span class="title function_">keys</span>(el.<span class=property>loadingStyle</span>).<span class="title function_">forEach</span>(<span class=function><span class=params>property</span> =></span> {</span><br><span class=line>          el.<span class=property>loading</span>.<span class=property>style</span>[property] = el.<span class=property>loadingStyle</span>[property];</span><br><span class=line>        });</span><br><span class=line>        <span class=keyword>if</span>(el.<span class=property>originalPosition</span> !== <span class=string>'absolute'</span>) {</span><br><span class=line>          parent.<span class=property>style</span>.<span class=property>position</span> = <span class=string>'relative'</span></span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>if</span> (binding.<span class=property>modifiers</span>.<span class=property>fullscreen</span>) {</span><br><span class=line>          parent.<span class=property>style</span>.<span class=property>overflow</span> = <span class=string>'hidden'</span></span><br><span class=line>        }</span><br><span class=line>        el.<span class=property>domVisible</span> = <span class=literal>true</span>;</span><br><span class=line>        parent.<span class="title function_">appendChild</span>(el.<span class=property>loading</span>) <span class=comment>// 插入的是el.loading而不是el本身</span></span><br><span class=line>        <span class="title class_">Vue</span>.<span class="title function_">nextTick</span>(<span class=function>() =></span> {</span><br><span class=line>          el.<span class=property>instance</span>.<span class=property>visible</span> = <span class=literal>true</span>;</span><br><span class=line>        });</span><br><span class=line>        el.<span class=property>domInserted</span> = <span class=literal>true</span>;</span><br><span class=line>      }</span><br><span class=line>    }</span><br><span class=line>  }</span><br><span class=line>}</span><br></pre></table></figure><p>同样，写完整个逻辑，我们需要将其注册到项目里的Vue下：<figure class="highlight js"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line><span class=comment>// main.js</span></span><br><span class=line></span><br><span class=line><span class=comment>// ...</span></span><br><span class=line><span class=keyword>import</span> <span class="title class_">Loading</span> <span class=keyword>from</span> <span class=string>'loading/index.js'</span></span><br><span class=line></span><br><span class=line><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Loading</span>)</span><br><span class=line></span><br><span class=line><span class=comment>// ...</span></span><br></pre></table></figure><p>至此我们已经可以使用形如<figure class="highlight html"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=tag>&lt;<span class=name>div</span> <span class=attr>v-loading.fullscreen</span>=<span class=string>"loading"</span> <span class=attr>loading-text</span>=<span class=string>"正在加载中"</span>></span></span><br></pre></table></figure><p>这样的方式来实现调用一个loading组件了。<h3 id=总结><a class=headerlink href=#总结 title=总结></a>总结</h3><p>在用Vue写我们的项目的时候，不管是写页面还是写形如这样的功能型组件，其实都是一件很有意思的事情。本文介绍的三种调用组件的方式，也是根据实际情况出发而实际操作、实现的。不同的组件通过不同的方式去调用，方便了开发人员，也能更好地对代码进行维护。当然也许还有其他的方式，我并没有了解，也欢迎大家在评论里指出！<p>最后再次感谢<a href=https://github.com/ElemeFE/element>element-ui</a>的源码给予的极大启发。</div></article><div class=post-copyright><div class=post-copyright__author><span class=post-copyright-meta>Author: </span><span class=post-copyright-info><a href=mailto:undefined>Molunerfinn</a></span></div><div class=post-copyright__type><span class=post-copyright-meta>Link: </span><span class=post-copyright-info><a href=https://molunerfinn.com/vue-components/>https://molunerfinn.com/vue-components/</a></span></div><div class=post-copyright__notice><span class=post-copyright-meta>Copyright Notice: </span><span class=post-copyright-info>All articles in this blog are licensed under <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class=post-meta__tag-list><a class=post-meta__tags href=/tags/%E5%89%8D%E7%AB%AF/>前端</a><a class=post-meta__tags href=/tags/Vue/>Vue</a></div><div class=post-qr-code><div class=post-qr-code-item><img class=post-qr-code__img src=https://blog-1251750343.cos.ap-beijing.myqcloud.com/blog/alipay.jpg><div class=post-qr-code__desc>支付宝打赏</div></div><div class=post-qr-code-item><img class=post-qr-code__img src=https://blog-1251750343.cos.ap-beijing.myqcloud.com/blog/wechat-pay.jpg><div class=post-qr-code__desc>微信打赏</div></div></div><div class="addthis_inline_share_toolbox pull-right"></div><script src="https://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5994f8f0fea9a5f4" async></script><nav id=pagination><div class="prev-post pull-left"><a href=/hexo-travisci-https/><i class="fa fa-chevron-left"> </i><span>hexo持久化构建以及给自有域名github-page上HTTPS</span></a></div><div class="next-post pull-right"><a href=/Webpack-Optimize/><span>Vuejs项目的Webpack2构建优化</span><i class="fa fa-chevron-right"></i></a></div></nav><div class=post-adv><div align=center><sup>Special thanks to:</sup><br><a href=https://go.warp.dev/picgo><img alt="Warp sponsorship" src=https://raw.githubusercontent.com/warpdotdev/brand-assets/refs/heads/main/Github/Sponsor/Warp-Github-LG-03.png width=400></a><div><a href=https://go.warp.dev/picgo>Warp, the intelligent terminal for developers</a></div><a href=https://go.warp.dev/picgo>Available for MacOS, Linux, & Windows</a><br></div></div><div id=gitalk-container></div><script>var gitalk = new Gitalk({
  clientID: 'f7b6cca0b0a65f07a027',
  clientSecret: '7f2daa09738c589122bf2882ee8cdbc62607c4d8',
  repo: 'Molunerfinn.github.io',
  owner: 'Molunerfinn',
  admin: 'Molunerfinn',
  id: md5(decodeURI(location.pathname)),
  language: 'en'
})
gitalk.render('gitalk-container')</script></div></div><footer style="background-image: url(https://pics.molunerfinn.com/blog/blog-bg.jpg)" class=footer-bg><div class=layout id=footer><div class=copyright>©2015 - 2025 By Molunerfinn</div><div class=framework-info><span>Driven - </span><a href=http://hexo.io><span>Hexo</span></a><span class=footer-separator>|</span><span>Theme - </span><a href=https://github.com/Molunerfinn/hexo-theme-melody><span>Melody</span></a></div><div class=busuanzi><script async src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span id=busuanzi_container_page_pv><i class="fa fa-file-o"></i><span id=busuanzi_value_page_pv></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" aria-hidden=true id=go-up></i><script src=https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js></script><script src=https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js></script><script src=https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js></script><script src=https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js></script><script src=/js/utils.js></script><script src=/js/fancybox.js></script><script src=/js/sidebar.js></script><script src=/js/copy.js></script><script src=/js/fireworks.js></script><script src=/js/transition.js></script><script src=/js/scroll.js></script><script src=/js/head.js></script><script src=/js/search/algolia.js></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class=search-dialog id=algolia-search><div class=search-dialog__title id=algolia-search-title>Algolia</div><div id=algolia-input-panel><div id=algolia-search-input></div></div><hr><div id=algolia-search-results><div id=algolia-hits></div><div id=algolia-pagination></div><div id=algolia-stats></div></div><span class=search-close-button><i class="fa fa-times"></i></span></div><div class=search-mask></div>